# GRAYLOG
# log_format  graylog2_format  '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for" <msec=$msec|connection=$connection|connection_requests=$connection_requests|millis=$request_time>';
# access_log syslog:server=10.0.10.12:12301 graylog2_format;
# error_log syslog:server=10.0.10.12:12302;

# FILES
# error_log  /var/log/nginx/error.log;
# access_log /var/log/nginx/access.log;

# STDOUT
# error_log  /dev/stdout;
# access_log /dev/stderr;

# Basic reverse proxy server

upstream api.dash {
   server api.dash:80;
}

upstream library.dash {
   server library.dash:80;
}

upstream media.dash {
   server media.dash:80;
}

upstream entertainment.dash  {
   server entertainment.dash:80;
}

server {
    listen 80;
    # proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    location /api {
        proxy_pass http://api.dash;
    }

    location /library {
        proxy_pass http://library.dash;
    }

    location /media {
        proxy_pass http://media.dash;
    }

    location /entertainment {
        proxy_pass http://entertainment.dash;
    }
}
